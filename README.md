# ember-cli-mixed-form-data

## Installation

This addon comes bundled with an adapter mixin, a serializer mixin, and a "file" transform.

To install into your Ember CLI app, just run:

```sh
your-project/$ ember install ember-cli-mixed-form-data
```

Then apply the mixin to your adapter and serializer:

```js
// app/adapters/application.js
import DS from 'ember-data';
import FormDataMixin from 'ember-cli-mixed-form-data/mixins/adapter';

export default DS.JSONAPIAdapter.extend({ FormDataMixin });

// app/serializers/application.js
import DS from 'ember-data';
import FormDataMixin from 'ember-cli-mixed-form-data/mixins/serializer';

export default DS.JSONAPISerializer.extend({ FormDataMixin });
```

The transform should be available automatically, just use it like so:

```js
// app/models/user.js
export default DS.Model.extend({
  avatar: DS.attr('file')
});
```

## Server side integration

This addon requires that your server properly parse multipart requests. You can use the [multipart-json-file-parser](https://github.com/davewasmer/multipart-json-file-parser) middleware directly in an Express server to handle this. See that project for installation instructions, or the expected behavior so you can build your own parser.

The multipart request will have one part named "json", containing the typical request JSON generated by your serializer. The other parts will be files, each named according to their model attribute name (i.e. `avatar: DS.attr('file')` would result in a multipart request with one part named `avatar`).

## How it works

Multipart HTTP requests allow you to send a single HTTP request with multiple parts consisting of potentially different content types. The goal of this addon is to enable the sending of files *and* the JSON data related to them in a single request.

The adapter mixin uses the FormData API to build up a multipart request consisting of your data and files.

The serializer mixin discovers any files on the outgoing model, and pulls them aside for the adapter to bundle with the JSON later on.

The transform simply flags model attributes as being files, so the serializer can then discover them easily.

## Why not ember-cli-form-data?

`ember-cli-form-data` is a similar project, and this project borrows heavily from it. But that project limits uploads to purely file uploads, whereas this project allows you to send file and JSON uploads in a single request.

The goal of this project is to let you treat file uploads like any other piece of data from within Ember.
